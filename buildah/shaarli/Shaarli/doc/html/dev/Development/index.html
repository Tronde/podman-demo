<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">



    <title>Development - Shaarli Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Development";
        var mkdocs_page_input_path = "dev/Development.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Shaarli Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Setup</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../Server-configuration/">Server configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Docker/">Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Reverse-proxy/">Reverse Proxy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Backup-and-restore/">Backup and restore</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Shaarli-configuration/">Shaarli configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Plugins/">Plugins</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Upgrade-and-migration/">Upgrade and migration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../Usage/">Usage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../REST-API/">REST API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Community-and-related-software/">Community and Related software</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Development</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#guidelines">Guidelines</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#third-party-libraries">Third-party libraries</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#security">Security</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#link-structure">Link structure</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#directory-structure">Directory structure</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#automation">Automation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#continuous-integration">Continuous Integration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#documentation">Documentation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#static-analysis">Static analysis</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Versioning/">Versioning</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../GnuPG-signature/">GnuPG signature</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Plugin-system/">Plugin System</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Translations/">Translations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Release-Shaarli/">Release Shaarli</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Theming/">Theming</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Unit-tests/">Unit tests</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Shaarli Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Development &raquo;</li>
      <li>Development</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/shaarli/Shaarli/edit/master/doc/md/dev/Development.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="development">Development<a class="headerlink" href="#development" title="Permanent link">#</a></h1>
<p>Please read <a href="https://github.com/shaarli/Shaarli/tree/master/CONTRIBUTING.md">Contributing to Shaarli</a></p>
<h2 id="guidelines">Guidelines<a class="headerlink" href="#guidelines" title="Permanent link">#</a></h2>
<ul>
<li><a href="Unit-tests">Unit tests</a></li>
<li>Javascript linting - Shaarli uses <a href="https://github.com/airbnb/javascript">Airbnb JavaScript Style Guide</a>.
Run <code>make eslint</code> to check JS style.</li>
<li><a href="GnuPG-signature">GnuPG signature</a> for tags/releases</li>
</ul>
<h2 id="third-party-libraries">Third-party libraries<a class="headerlink" href="#third-party-libraries" title="Permanent link">#</a></h2>
<p>CSS:</p>
<ul>
<li>Yahoo UI <a href="http://yuilibrary.com/yui/docs/cssreset/">CSS Reset</a> - standardize cross-browser rendering</li>
</ul>
<p>Javascript:</p>
<ul>
<li><a href="https://leaverou.github.io/awesomplete/">Awesomeplete</a> (<a href="https://github.com/LeaVerou/awesomplete">GitHub</a>) - autocompletion in input forms</li>
<li><a href="http://dinbror.dk/blazy/">bLazy</a> (<a href="https://github.com/dinbror/blazy">GitHub</a>) - lazy loading for thumbnails</li>
<li><a href="http://neocotic.com/qr.js/">qr.js</a> (<a href="https://github.com/neocotic/qr.js">GitHub</a>) - QR code generation</li>
</ul>
<p>PHP (managed through <a href="https://github.com/shaarli/Shaarli/blob/master/composer.json"><code>composer.json</code></a>):</p>
<ul>
<li><a href="https://github.com/rainphp/raintpl">RainTPL</a> - HTML templating for PHP</li>
<li><a href="https://packagist.org/packages/shaarli/netscape-bookmark-parser"><code>shaarli/netscape-bookmark-parser</code></a> - Import bookmarks from Netscape files</li>
<li><a href="https://packagist.org/packages/erusev/parsedown"><code>erusev/parsedown</code></a> - Parse MarkDown syntax for the MarkDown plugin</li>
<li><a href="https://packagist.org/packages/slim/slim"><code>slim/slim</code></a> - Handle routes and middleware for the REST API</li>
<li><a href="https://github.com/ArthurHoaro/web-thumbnailer"><code>ArthurHoaro/web-thumbnailer</code></a> - PHP library which will retrieve a thumbnail for any given URL</li>
<li><a href="https://github.com/pubsubhubbub/php-publisher"><code>pubsubhubbub/publisher</code></a> - A PubSubHubbub publisher module for PHP.</li>
<li><a href="https://github.com/php-gettext/Gettext"><code>gettext/gettext</code></a> - PHP library to collect and manipulate gettext (.po, .mo, .php, .json, etc)</li>
</ul>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">#</a></h2>
<ul>
<li>The password is salted, hashed and stored in the data subdirectory, in a PHP file, and protected by htaccess. Even if the webserver does not support htaccess, the hash is not readable by URL. Even if the .php file is stolen, the password cannot deduced from the hash. The salt prevents rainbow-tables attacks.</li>
<li>Directories are protected using <code>.htaccess</code> files</li>
<li>Forms are protected against <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">XSRF</a>:<ul>
<li>Forms which act on data (save,delete…) contain a token generated by the server.</li>
<li>Any posted form which does not contain a valid token is rejected.</li>
<li>Any token can only be used once.</li>
<li>Tokens are attached to the session and cannot be reused in another session.</li>
</ul>
</li>
<li>Sessions automatically expire after 60 minutes.</li>
<li>Sessions are protected against hijacking: the session ID cannot be used from a different IP address.</li>
<li>Links are stored as an associative array which is serialized, compressed (with deflate), base64-encoded and saved as a comment in a <code>.php</code> file - even if the server does not support <code>.htaccess</code> files, the data file will still not be readable by URL.</li>
<li>Bruteforce protection: Successful and failed login attempts are logged - IP bans are enforced after a configurable amount of failures. Logs can also be used consumed by <a href="../../Server-configuration/#fail2ban">fail2ban</a></li>
<li>A pop-up notification is shown when a new release is available.</li>
</ul>
<h2 id="link-structure">Link structure<a class="headerlink" href="#link-structure" title="Permanent link">#</a></h2>
<p>Every link available through the <code>LinkDB</code> object is represented as an array
containing the following fields:</p>
<ul>
<li><code>id</code> (integer): Unique identifier.</li>
<li><code>title</code> (string): Title of the link.</li>
<li><code>url</code> (string): URL of the link. Used for displayable links (without redirector, url encoding, etc.).
           Can be absolute or relative for Notes.</li>
<li><code>real_url</code> (string): Real destination URL, can be redirected, encoded, etc.</li>
<li><code>shorturl</code> (string): Permalink small hash.</li>
<li><code>description</code> (string): Link text description.</li>
<li><code>private</code> (boolean): whether the link is private or not.</li>
<li><code>tags</code> (string): all link tags separated by a single space</li>
<li><code>thumbnail</code> (string|boolean): relative path of the thumbnail cache file, or false if there isn't any.</li>
<li><code>created</code> (DateTime): link creation date time.</li>
<li><code>updated</code> (DateTime): last modification date time.</li>
</ul>
<p>Small hashes are used to make a link to an entry in Shaarli. They are unique: the date of the item (eg. <code>20110923_150523</code>) is hashed with CRC32, then converted to base64 and some characters are replaced. They are always 6 characters longs and use only <code>A-Z a-z 0-9 - _</code> and <code>@</code>.</p>
<h2 id="directory-structure">Directory structure<a class="headerlink" href="#directory-structure" title="Permanent link">#</a></h2>
<p>Here is the directory structure of Shaarli and the purpose of the different files:</p>
<pre><code class="language-bash">    index.php        # Main program
    application/     # Shaarli classes
        ├── LinkDB.php

        ...

        └── Utils.php
    tests/           # Shaarli unitary &amp; functional tests
        ├── LinkDBTest.php

        ...

        ├── utils    # utilities to ease testing
        │   └── ReferenceLinkDB.php
        └── UtilsTest.php
    assets/
        ├── common/                # Assets shared by multiple themes
            ├── ...
        ├── default/               # Assets for the default template, before compilation
            ├── fonts/                  # Font files
            ├── img/                    # Images used by the default theme
            ├── js/                     # JavaScript files in ES6 syntax
            ├── scss/                   # SASS files
        └── vintage/               # Assets for the vintage template, before compilation
            └── ...
    COPYING          # Shaarli license
    inc/             # static assets and 3rd party libraries
        └── rain.tpl.class.php     # RainTPL templating library
    images/          # Images and icons used in Shaarli
    data/            # data storage: bookmark database, configuration, logs, banlist...
        ├── config.json.php        # Shaarli configuration (login, password, timezone, title...)
        ├── datastore.php          # Your link database (compressed).
        ├── ipban.php              # IP address ban system data
        ├── lastupdatecheck.txt    # Update check timestamp file
        └── log.txt                # login/IPban log.
    tpl/             # RainTPL templates for Shaarli. They are used to build the pages.
        ├── default/               # Default Shaarli theme
            ├── fonts/                  # Font files
            ├── img/                    # Images
            ├── js/                     # JavaScript files compiled by Babel and compatible with all browsers
            ├── css/                    # CSS files compiled with SASS
        └── vintage/               # Legacy Shaarli theme
            └── ...
    cache/           # thumbnails cache
                     # This directory is automatically created. You can erase it anytime you want.
    tmp/             # Temporary directory for compiled RainTPL templates.
                     # This directory is automatically created. You can erase it anytime you want.
    vendor/          # Third-party dependencies. This directory is created by Composer
</code></pre>
<p>Shaarli needs read access to:</p>
<ul>
<li>the root index.php file</li>
<li>the <code>application/</code>, <code>plugins/</code> and <code>inc/</code> directories (recursively)</li>
</ul>
<p>Shaarli needs read/write access to the <code>cache/</code>, <code>data/</code>, <code>pagecache/</code>, and <code>tmp/</code> directories</p>
<h2 id="automation">Automation<a class="headerlink" href="#automation" title="Permanent link">#</a></h2>
<p>A <a href="https://github.com/shaarli/Shaarli/blob/master/Makefile"><code>Makefile</code></a> is available to perform project-related operations:</p>
<ul>
<li><a href="#Static-analysis">Static analysis</a> - check that the code is compliant to PHP conventions</li>
<li><a href="#Unit-tests">Unit tests</a> - ensure there are no regressions introduced by new commits</li>
<li>Documentation - generate a local HTML copy of the markdown documentation</li>
</ul>
<h3 id="continuous-integration">Continuous Integration<a class="headerlink" href="#continuous-integration" title="Permanent link">#</a></h3>
<p><a href="https://github.com/shaarli/Shaarli/actions">Github Actions</a> is a Continuous Integration build server, that runs a build:</p>
<ul>
<li>each time a commit is pushed to any branch</li>
<li>each time a Pull Request is submitted or updated</li>
</ul>
<p>After all jobs have finished, Github Actions returns the results to GitHub:</p>
<ul>
<li>a status icon represents the result for the <code>master</code> branch: <a href="https://github.com/shaarli/Shaarli/actions"><img alt="Build Status" src="https://github.com/shaarli/Shaarli/actions/workflows/ci.yml/badge.svg" /></a></li>
<li>Pull Requests are updated with the Github Actions build result.</li>
</ul>
<p>Github Actions is also used to build and push <a href="../../Docker/">Docker</a> images to <a href="https://github.com/shaarli/Shaarli/pkgs/container/shaarli">https://github.com/shaarli/Shaarli/pkgs/container/shaarli</a> for the <code>master</code> branch and on every git <code>tag</code>/<a href="https://github.com/shaarli/Shaarli/releases">release</a>.</p>
<p>See <a href="https://github.com/shaarli/Shaarli/tree/master/.github/workflows"><code>.github/workflows/</code></a>.</p>
<h3 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">#</a></h3>
<p><a href="https://www.mkdocs.org/">mkdocs</a> is used to convert markdown documentation to HTML pages. The <a href="https://shaarli.readthedocs.io/en/master/">public documentation</a> website is rendered and hosted by <a href="https://readthedocs.org/">readthedocs.org</a>. A copy of the documentation is also included in prebuilt <a href="https://github.com/shaarli/Shaarli/releases">release archives</a> (<code>doc/html/</code> path in your Shaarli installation). To generate the HTML documentation locally, install a recent version of Python <code>setuptools</code> and run <code>make doc</code>.</p>
<h2 id="static-analysis">Static analysis<a class="headerlink" href="#static-analysis" title="Permanent link">#</a></h2>
<p>Patches should try to stick to the <a href="http://www.php-fig.org/psr/">PHP Standard Recommendations</a> (PSR), and must follow:</p>
<ul>
<li><a href="http://www.php-fig.org/psr/psr-1/">PSR-1</a> - Basic Coding Standard</li>
<li><a href="http://www.php-fig.org/psr/psr-2/">PSR-2</a> - Coding Style Guide</li>
<li><a href="http://www.php-fig.org/psr/psr-12/">PSR-12</a> - Extended Coding Style Guide</li>
</ul>
<p>These are enforced on pull requests using our Continuous Integration tools with <a href="https://github.com/squizlabs/PHP_CodeSniffer">PHP Code Sniffer</a>.</p>
<p>Static analysis tools are installed with Composer dependencies, and used through Shaarli's <a href="https://github.com/shaarli/Shaarli/blob/master/Makefile">Makefile</a> with <code>make code_sniffer</code>.</p>
<p>For an overview of the available features, see:</p>
<ul>
<li><a href="https://github.com/shaarli/Shaarli/pull/124">Code quality: Makefile to run static code checkers</a> (#124)</li>
<li><a href="https://github.com/shaarli/Shaarli/pull/1635">Apply PHP Code Sniffer to Shaarli code base</a> (#1635)</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../Community-and-related-software/" class="btn btn-neutral float-left" title="Community and Related software"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../Versioning/" class="btn btn-neutral float-right" title="Versioning">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/shaarli/Shaarli" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../Community-and-related-software/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Versioning/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
